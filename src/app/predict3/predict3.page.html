

<ion-header>
  <ion-toolbar class="custom-content">
    <ion-buttons slot="start" >
      <ion-back-button defaultHref="tabs/tabs/tab1" class="custom-back-button"></ion-back-button>
    </ion-buttons>
    <ion-title style="color: black;">Predicciones del nivel de Anemia</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="custom-content">
  <form class="form-container" [formGroup]="anemiaForm" class="form-container" (ngSubmit)="onSubmit()">
    <ion-card class="custom-content">
      <ion-card-header>
        <ion-card-title style="color: black;">Información Personal</ion-card-title>
      </ion-card-header>
      <ion-card-content >
        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">DNI</ion-label>
          <ion-input type="text" formControlName="dni" style="color: black;"></ion-input>
          <ion-button slot="end" (click)="onDniSearch()">Buscar</ion-button>
        </ion-item>
        <div *ngIf="anemiaForm.get('dni')?.touched && anemiaForm.get('dni')?.invalid" class="error-message">
          DNI es requerido y debe ser válido.
        </div>

        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">Nombre y Apellido</ion-label>
          <ion-input type="text" formControlName="nombre_apellido" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('nombre_apellido')?.touched && anemiaForm.get('nombre_apellido')?.invalid" class="error-message">
          Nombre y Apellido es requerido y debe ser válido.
        </div>
        <ion-item class="custom-content">
          <ion-label style="color: black;">Sexo</ion-label>
          <ion-select style="color: black;" formControlName="sexo">
            <ion-select-option value="M" >Masculino</ion-select-option>
            <ion-select-option value="F" >Femenino</ion-select-option>
          </ion-select>
        </ion-item>
        <div *ngIf="anemiaForm.get('sexo')?.touched && anemiaForm.get('sexo')?.invalid" class="error-message" class="error-message">
          Sexo es requerido.
        </div>
        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">Edad (mes)</ion-label>
          <ion-input type="number" formControlName="edad" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('edad')?.touched && anemiaForm.get('edad')?.invalid" class="error-message">
          Edad es requerida y debe estar entre 6 y 60 meses.
        </div>

      </ion-card-content>
    </ion-card>

    <ion-card class="custom-content">
      <ion-card-header>
        <ion-card-title style="color: black;">Medidas Corporales</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">Peso (kg)</ion-label>
          <ion-input type="number" formControlName="peso" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('peso')?.touched && anemiaForm.get('peso')?.errors" class="error-message">
          <div *ngIf="anemiaForm.get('peso')?.hasError('required')">Peso es requerido.</div>
          <div *ngIf="anemiaForm.get('peso')?.hasError('pesoOutOfRange')">
            Peso fuera del rango para la edad especificada. Debe estar entre
            {{ anemiaForm.get('peso')?.getError('peso_min') }} y
            {{ anemiaForm.get('peso')?.getError('peso_max') }} kg.
          </div>
        </div>

        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">Altura (cm)</ion-label>
          <ion-input type="number" formControlName="altura" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('altura')?.touched && anemiaForm.get('altura')?.errors" class="error-message">
          <div *ngIf="anemiaForm.get('altura')?.hasError('required')">Altura es requerida.</div>
          <div *ngIf="anemiaForm.get('altura')?.hasError('alturaOutOfRange')">
            Altura fuera del rango para la edad especificada. Debe estar entre
            {{ anemiaForm.get('altura')?.getError('altura_min') }} y
            {{ anemiaForm.get('altura')?.getError('altura_max') }} cm.
          </div>
        </div>


      </ion-card-content>
    </ion-card>

    <ion-card class="custom-content">
      <ion-card-header>
        <ion-card-title style="color: black;">Resultados de Laboratorio</ion-card-title>
      </ion-card-header>
      <!-- <ion-card-content>
        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">Hmg (g/dl)</ion-label>
          <ion-input type="number" formControlName="hmg" style="color: black;" ></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('hmg')?.touched && anemiaForm.get('hmg')?.invalid" class="error-message">
          Hmg es requerido y debe estar entre 5 y 18.5 g/dl.
        </div>
        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">PCV</ion-label>
          <ion-input type="number" formControlName="pcv" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('pcv')?.touched && anemiaForm.get('pcv')?.invalid">
          PCV es requerido y debe estar entre 29 y 60 %.
        </div>

        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">MCV</ion-label>
          <ion-input type="number" formControlName="mcv" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('mcv')?.touched && anemiaForm.get('mcv')?.invalid">
          MCV es requerido y debe estar entre 77 fL y 119 fL.
        </div>

        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">MCH</ion-label>
          <ion-input type="number" formControlName="mch" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('mch')?.touched && anemiaForm.get('mch')?.invalid">
          MCH es requerido y debe estar entre 25 y 36.
        </div>

        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">MCHC</ion-label>
          <ion-input type="number" formControlName="mchc" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('mchc')?.touched && anemiaForm.get('mchc')?.invalid">
          MCHC es requerido y debe estar entre 30 g/dL y 36 g/dL.
        </div>

        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">RDW</ion-label>
          <ion-input type="number" formControlName="rdw" style="color: black;" ></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('rdw')?.touched && anemiaForm.get('rdw')?.invalid">
          RDW es requerido y debe estar entre 11.5 % y 14.5 %.
        </div>
        <ion-item class="custom-content">
          <ion-label position="floating" style="color: black;">TLC</ion-label>
          <ion-input type="number" formControlName="tlc" style="color: black;"></ion-input>
        </ion-item>
        <div *ngIf="anemiaForm.get('tlc')?.touched && anemiaForm.get('tlc')?.invalid">
          TLC es requerido y debe estar entre 4.5 y 38.0 mil/µL.
        </div>
      </ion-card-content> -->
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">Hmg (g/dl)</ion-label>
                <ion-input type="number" formControlName="hmg" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('hmg')?.touched && anemiaForm.get('hmg')?.invalid" class="error-message">
                Hmg es requerido y debe estar entre 5 y 18.5 g/dl.
              </div>
            </ion-col>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">PCV</ion-label>
                <ion-input type="number" formControlName="pcv" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('pcv')?.touched && anemiaForm.get('pcv')?.invalid">
                PCV es requerido y debe estar entre 29 y 60 %.
              </div>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">MCV</ion-label>
                <ion-input type="number" formControlName="mcv" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('mcv')?.touched && anemiaForm.get('mcv')?.invalid" class="error-message">
                MCV es requerido y debe estar entre 77 fL y 119 fL.
              </div>
            </ion-col>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">MCH</ion-label>
                <ion-input type="number" formControlName="mch" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('mch')?.touched && anemiaForm.get('mch')?.invalid" class="error-message">
                MCH es requerido y debe estar entre 25 y 36.
              </div>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">MCHC</ion-label>
                <ion-input type="number" formControlName="mchc" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('mchc')?.touched && anemiaForm.get('mchc')?.invalid" class="error-message">
                MCHC es requerido y debe estar entre 30 g/dL y 36 g/dL.
              </div>
            </ion-col>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">RDW</ion-label>
                <ion-input type="number" formControlName="rdw" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('rdw')?.touched && anemiaForm.get('rdw')?.invalid" class="error-message">
                RDW es requerido y debe estar entre 11.5 % y 14.5 %.
              </div>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col>
              <ion-item class="custom-content">
                <ion-label position="floating" style="color: black;">TLC</ion-label>
                <ion-input type="number" formControlName="tlc" style="color: black;"></ion-input>
              </ion-item>
              <div *ngIf="anemiaForm.get('tlc')?.touched && anemiaForm.get('tlc')?.invalid" class="error-message">
                TLC es requerido y debe estar entre 4.5 y 38.0 mil/µL.
              </div>
            </ion-col>
            <ion-col>
              <!-- Deja esta columna vacía para mantener la estructura de 2 columnas -->
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <ion-button expand="full" type="submit" color="primary" class="submit-button">Predecir</ion-button>
  </form>

  <ion-alert
    [isOpen]=""
    header="Resultado"
    message="No tiene anemia"
    buttons="OK">
  </ion-alert>

  <ion-alert
    [isOpen]=""
    header="Registro"
    message="Registro exitoso"
    buttons="OK">
  </ion-alert>

  <ion-alert
    [isOpen]=""
    header="Enviar a WhatsApp"
    message="¿Deseas enviar esta información a WhatsApp?"
    inputs="[{ name: 'numero', type: 'text', placeholder: 'Ingrese su número de WhatsApp' }]"
    buttons="[
      { text: 'Solo Predecir', role: 'cancel' },
      { text: 'Enviar', handler: (data) => sendToWhatsApp(data.numero) }
    ]">
  </ion-alert>
</ion-content>

<style>
  .custom-content {
    --background: white;
  }
  .form-container {
    padding: 16px;
  }
  .custom-back-button {
    --color: black;
  }
  .submit-button {
    margin-top: 20px;
  }
  .resultado-container {
    margin-top: 20px;
  }
  .error-message {
    color: red;
    font-size: 12px;
    margin-left: 16px;
  }
</style>


